{
  "vulnerable": {
    "idx": 209026,
    "project": "libvirt",
    "commit_id": "4c4d0e2da07b5a035b26a0ff13ec27070f7c7b1a",
    "commit_url": "https://gitlab.com/libvirt/libvirt/-/commit/4c4d0e2da07b5a035b26a0ff13ec27070f7c7b1a",
    "commit_message": "conf: Fix segfault when parsing mdev types\n\nCommit f1b0890 introduced a potential crash due to incorrect operator\nprecedence when accessing an element from a pointer to an array.\n\nBacktrace below:\n\n  #0  virNodeDeviceGetMdevTypesCaps (sysfspath=0x7fff801661e0 \"/sys/devices/pci0000:00/0000:00:02.0\", mdev_types=0x7fff801c9b40, nmdev_types=0x7fff801c9b48) at ../src/conf/node_device_conf.c:2676\n  #1  0x00007ffff7caf53d in virNodeDeviceGetPCIDynamicCaps (sysfsPath=0x7fff801661e0 \"/sys/devices/pci0000:00/0000:00:02.0\", pci_dev=0x7fff801c9ac8) at ../src/conf/node_device_conf.c:2705\n  #2  0x00007ffff7cae38f in virNodeDeviceUpdateCaps (def=0x7fff80168a10) at ../src/conf/node_device_conf.c:2342\n  #3  0x00007ffff7cb11c0 in virNodeDeviceObjMatch (obj=0x7fff84002e50, flags=0) at ../src/conf/virnodedeviceobj.c:850\n  #4  0x00007ffff7cb153d in virNodeDeviceObjListExportCallback (payload=0x7fff84002e50, name=0x7fff801cbc20 \"pci_0000_00_02_0\", opaque=0x7fffe2ffc6a0) at ../src/conf/virnodedeviceobj.c:909\n  #5  0x00007ffff7b69146 in virHashForEach (table=0x7fff9814b700 = {...}, iter=0x7ffff7cb149e <virNodeDeviceObjListExportCallback>, opaque=0x7fffe2ffc6a0) at ../src/util/virhash.c:394\n  #6  0x00007ffff7cb1694 in virNodeDeviceObjListExport (conn=0x7fff98013170, devs=0x7fff98154430, devices=0x7fffe2ffc798, filter=0x7ffff7cf47a1 <virConnectListAllNodeDevicesCheckACL>, flags=0)\n          at ../src/conf/virnodedeviceobj.c:943\n  #7  0x00007fffe00694b2 in nodeConnectListAllNodeDevices (conn=0x7fff98013170, devices=0x7fffe2ffc798, flags=0) at ../src/node_device/node_device_driver.c:228\n  #8  0x00007ffff7e703aa in virConnectListAllNodeDevices (conn=0x7fff98013170, devices=0x7fffe2ffc798, flags=0) at ../src/libvirt-nodedev.c:130\n  #9  0x000055555557f796 in remoteDispatchConnectListAllNodeDevices (server=0x555555627080, client=0x5555556bf050, msg=0x5555556c0000, rerr=0x7fffe2ffc8a0, args=0x7fffd4008470, ret=0x7fffd40084e0)\n          at src/remote/remote_daemon_dispatch_stubs.h:1613\n  #10 0x000055555557f6f9 in remoteDispatchConnectListAllNodeDevicesHelper (server=0x555555627080, client=0x5555556bf050, msg=0x5555556c0000, rerr=0x7fffe2ffc8a0, args=0x7fffd4008470, ret=0x7fffd40084e0)\n          at src/remote/remote_daemon_dispatch_stubs.h:1591\n  #11 0x00007ffff7ce9542 in virNetServerProgramDispatchCall (prog=0x555555690c10, server=0x555555627080, client=0x5555556bf050, msg=0x5555556c0000) at ../src/rpc/virnetserverprogram.c:428\n  #12 0x00007ffff7ce90bd in virNetServerProgramDispatch (prog=0x555555690c10, server=0x555555627080, client=0x5555556bf050, msg=0x5555556c0000) at ../src/rpc/virnetserverprogram.c:302\n  #13 0x00007ffff7cf042b in virNetServerProcessMsg (srv=0x555555627080, client=0x5555556bf050, prog=0x555555690c10, msg=0x5555556c0000) at ../src/rpc/virnetserver.c:137\n  #14 0x00007ffff7cf04eb in virNetServerHandleJob (jobOpaque=0x5555556b66b0, opaque=0x555555627080) at ../src/rpc/virnetserver.c:154\n  #15 0x00007ffff7bd912f in virThreadPoolWorker (opaque=0x55555562bc70) at ../src/util/virthreadpool.c:163\n  #16 0x00007ffff7bd8645 in virThreadHelper (data=0x55555562bc90) at ../src/util/virthread.c:233\n  #17 0x00007ffff6d90432 in start_thread () at /lib64/libpthread.so.0\n  #18 0x00007ffff75c5913 in clone () at /lib64/libc.so.6\n\nSigned-off-by: Jonathon Jongsma <jjongsma@redhat.com>\nReviewed-by: J\u00e1n Tomko <jtomko@redhat.com>\nSigned-off-by: J\u00e1n Tomko <jtomko@redhat.com>",
    "cve": "CVE-2021-3559",
    "cve_desc": "A flaw was found in libvirt in the virConnectListAllNodeDevices API in versions before 7.0.0. It only affects hosts with a PCI device and driver that supports mediated devices (e.g., GRID driver). This flaw could be used by an unprivileged client with a read-only connection to crash the libvirt daemon by executing the 'nodedev-list' virsh command. The highest threat from this vulnerability is to system availability.",
    "cwe": [
      "CWE-119"
    ],
    "nvd_url": "https://nvd.nist.gov/vuln/detail/CVE-2021-3559",
    "file_name": "node_device_conf.c",
    "func_hash": 87286221830836043224209896676991521270,
    "file_hash": 38019949320953450079385512587806047567
  },
  "fixed": {
    "idx": 417472,
    "func_hash": 41677585075086071603512617130977145017,
    "file_hash": 190835973650812059595485281579904597762
  }
}